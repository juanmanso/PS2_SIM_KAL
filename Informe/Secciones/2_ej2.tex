
	El algoritmo de Kalman se basa en poder estimar el vector de estados a partir de la dinámica del sistema y las mediciones. Para la definición del algoritmo utilizaremos la siguiente notación. Llamaremos:
	
	\begin{equation*}
		\vect{x_{k/k - 1}}
	\end{equation*}
	
	A la mejor estimación de el vector de estados utilizando información hasta el instante $k - 1$. Es decir se trata de una predicción. Llamaremos a la matriz de covarianza del error de dicha estimacion:
	
	\begin{equation*}
		\vect{P_{k/k - 1}}
	\end{equation*}
	
	Por otro lado llamaremos a:
	
	\begin{equation*}
		\vect{x_{k/k}}
	\end{equation*}
	
	A la mejor estimación del vector de estados utilizando información hasta el instante $k$. Dicha estimación será el resultado final del algoritmo y la matriz de covarianza del error del mismo será:
	
	\begin{equation*}
		\vect{P_{k/k - 1}}
	\end{equation*}

	Cabe aclarar que cuando decimos mejor estimador, hacemos referencia a que se trata del que minimiza el error cuadrático medio. Dicho todo esto, presentamos el algoritmo de Kalman para poder realizar la estimación de la trayectoria.
	
		\subsection{Algoritmo de Kalman}
			\paragraph{Inicialización}
				Es la etapa en la que definimos el estado inicial de la estimación, para poder inicializar el algoritmo necesitamos una estadistica del estado inicial del sistema:
				
				\begin{equation*}
					\vect{x_{0/0}} \leftarrow E\left[\vect{x_{0}}\right]
				\end{equation*}
				
				\begin{equation*}
					P_{0/0} \leftarrow COV\left[\vect{x_{0}}\right]
				\end{equation*}
			\paragraph{Predicción}
				Es la etapa en la que realizarmos una predicción del futuro estado del sistema utilizando el modelo en el espacio de estados:
				
				\begin{equation*}
					\vect{x_{k/k - 1}} \leftarrow Ad_{k - 1} \vect{x_{k - 1/k - 1}}
				\end{equation*}
				
				\begin{equation*}
					P_{k/k - 1} \leftarrow Ad_{k - 1} P_{k - 1 / k - 1} Ad_{k - 1}^{*} + Bd_{k - 1} Q_{k - 1} Bd_{k - 1}^{*}
				\end{equation*}
			\paragraph{Corrección}
				Es la etapa en la que corregimos la predicción con el valor de la medición, para ello necesitamos calcular la matriz de ganancia de Kalman $K_{k}$:
				
				\begin{equation*}
					K_{k} \leftarrow P_{k / k - 1} Cd_{k}^{*} (Cd_{k} P_{k/k - 1} Cd_{k}^{*} + R_{k})^{-1}
				\end{equation*}
				
				Luego corregimos:
				
				\begin{equation*}
					\vect{x_{k/k}} \leftarrow \vect{x_{k/k - 1}} + K_{k} (y_{k} - Cd_{k} \vect{x_{k/k - 1}})
				\end{equation*}
				
				\begin{equation*}
					P_{k/k} \leftarrow (I - K_{k} Cd_{k}) P_{k/k - 1}
				\end{equation*}
					
			\paragraph{Actualización}
				Es la etapa del algoritmo que pasamos al siguiente instante k.
				
				\begin{equation*}
					\vect{x_{k - 1/k - 1}} \leftarrow \vect{x_{k/k}}
				\end{equation*}
				
				\begin{equation*}
					P_{k - 1/k - 1} \leftarrow P_{k/k}
				\end{equation*}

	\subsection{Resultados}
		\subsubsection{Medición De Posición}
			En la figura \ref{fig:ej2a} observamos los resultados de la estimación basada en mediciones de posición. Puede verse que la estimación se desvía menos del valor real que las mediciones.

		\begin{figure}[H]
			\centering
			\includegraphics[width=1.0\textwidth,keepaspectratio]{Figuras/graf_ej2a.pdf}
			\caption{Caso: Medición De Posición}
			\label{fig:ej2a}
		\end{figure}
		
		En la figura \ref{fig:ej2a_innov} vemos la correlación de las innovaciones, puede verse de que se aproximan a un proceso blanco.
		
		\begin{figure}[H]
			\centering
			\includegraphics[width=1.0\textwidth,keepaspectratio]{Figuras/covinn_ej2a.pdf}
			\caption{Caso: Medición De Posición - Innovaciones}
			\label{fig:ej2a_innov}
		\end{figure}
		
		\subsubsection{Medición De Velocidad}
		
		En la figura \ref{fig:ej2b} observamos los resultados de la estimación basada en mediciones de velocidad. Puede verse que hay una desviación de la estimación respecto de la trayectoria real.
		
		\begin{figure}[H]
			\centering
			\includegraphics[width=1.0\textwidth,keepaspectratio]{Figuras/graf_ej2b.pdf}
			\caption{Caso: Medición De Velocidad}
			\label{fig:ej2b}
		\end{figure}
		
		En la figura \ref{fig:ej2b_innov} vemos la correlación de las innovaciones, puede verse de que se aproximan a un proceso blanco.
		
		\begin{figure}[H]
			\centering
			\includegraphics[width=1.0\textwidth,keepaspectratio]{Figuras/covinn_ej2b.pdf}
			\caption{Caso: Medición De Velocidad - Innovaciones}
			\label{fig:ej2b_innov}
		\end{figure}
			
		\subsubsection{Medición De Aceleración}
		
		En la figura \ref{fig:ej2c} observamos los resultados de la estimación basada en mediciones de aceleración. Puede verse que la trayectoria estimada nunca sigue a la real.
		
		\begin{figure}[H]
			\centering
			\includegraphics[width=1.0\textwidth,keepaspectratio]{Figuras/graf_ej2c.pdf}
			\caption{Caso: Medición De Aceleración}
			\label{fig:ej2c}
		\end{figure}
		
		En la figura \ref{fig:ej2c_innov} vemos la correlación de las innovaciones, puede verse de que se aproximan a un proceso blanco.
		
		\begin{figure}[H]
			\centering
			\includegraphics[width=1.0\textwidth,keepaspectratio]{Figuras/covinn_ej2c.pdf}
			\caption{Caso: Medición De Aceleración - Innovaciones}
			\label{fig:ej2c_innov}
		\end{figure}

	\subsection{Script}
	
		A continuación presentamos el script de MATLAB que implementa el algoritmo. Se puede seleccionar si se esta midiendo posicion, velocidad o aceleracion, estableciendo las variables bool\_p, bool\_v o bool\_a en 1 o en 0 para indicar que se esta midiendo.
	
	%\lstinputlisting[]{../Octave/EJ2_full.m}
